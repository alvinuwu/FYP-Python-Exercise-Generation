@model List<OEQuestion_Templates>

<div class="container py-5">

    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="fw-bold text-primary">Auto Generate Open-Ended Questions</h1>
        <a class="btn btn-primary btn-lg" asp-action="GenerateOE" asp-controller="ExercisePaper">
            <i class="glyphicon glyphicon-plus"></i> Create Template
        </a>
    </div>

    <!-- TempData Message -->
    @if (TempData["Msg"] != null)
    {
        <div class="alert alert-@TempData["MsgType"] alert-dismissible fade show" role="alert">
            <strong>@Html.Raw(TempData["Msg"])</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Topic Selector -->
    <div class="card shadow-sm p-4 mb-4">
        <div class="row align-items-center">
            <label class="col-sm-2 col-form-label fw-semibold">Topic:</label>
            <div class="col-sm-6">
                <select id="topics" class="form-control" style="font-family: 'HP Simplified'">
                    <option value="0">All Topics</option>
                    @foreach (var topic in (SelectList)ViewData["topics"])
                    {
                        <option value="@topic.Value">@topic.Text</option>
                    }
                </select>
            </div>
        </div>
    </div>

    <!-- Questions Table -->
    <div class="card shadow-sm p-4">
        <div class="table-responsive">
            <table class="table table-striped table-hover table-bordered align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>#</th>
                        <th>Figure</th>
                        <th>Question</th>
                        <th>Answer</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="divQuestion">
                    @if (Model != null && Model.Any())
                    {
                        int count = 1;
                        foreach (var item in Model)
                        {
                            <tr>
                                <td>@count</td>
                                <td>
                                    @foreach (var line in item.Figure.Split("[nline]"))
                                    {
                                        @line <br />
                                    }
                                </td>
                                <td>
                                    @foreach (var line in item.Question.Split("[nline]"))
                                    {
                                        @line <br />
                                    }
                                </td>
                                <td>
                                    @foreach (var line in item.Answer.Split("[nline]"))
                                    {
                                        @line <br />
                                    }
                                </td>
                                <td class="text-center">
                                    <a class="btn btn-primary mb-2" href="/ExercisePaper/AutoGenerateQnPt2/?id=@item.Id&topicId=@item.TopicId">Generate</a><br />
                                    <a class="btn btn-success mb-2" style="transform: scaleX(-1);" asp-controller="ExercisePaper" asp-action="EditOEQuestionsTemplate" asp-route-id="@item.Id">&#9998;</a>
                                    <a class="btn btn-danger mb-2" style="transform: scaleX(-1);" onclick="return ConfirmDelete()" 
                                       asp-controller="ExercisePaper" asp-action="DeleteOEQuestionsTemplate" asp-route-id="@item.Id">
                                        <i class="fa fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                            count++;
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="5" class="text-center text-muted">No questions available</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

@section MoreScripts {
    <script>
        $(document).ready(function () {
            $("#topics").change(ajaxLoadQuestion);
        });

        function ConfirmDelete() {
            return confirm("Are you sure you want to delete?");
        }

        function ajaxLoadQuestion() {
            var topic = $("#topics").val();
            var apiUrl = "/api/OEQuestion/" + topic;
            var divQuestion = $("#divQuestion");

            divQuestion.html("");

            $.getJSON(apiUrl, function (result) {
                $.each(result, function (i, question) {
                    divQuestion.append(
                        "<tr>" +
                        "<td>" + (i + 1) + "</td>" +
                        "<td>" + question.figure.replace(/\[nline\]/g, "<br />") + "</td>" +
                        "<td>" + question.question.replace(/\[nline\]/g, "<br />") + "</td>" +
                        "<td>" + question.answer.replace(/\[nline\]/g, "<br />") + "</td>" +
                        "<td class='text-center'>" +
                        "<a class='btn btn-primary mb-2' href='/ExercisePaper/AutoGenerateQnPt2/?id=" + question.id + "&topicId=" + question.topicId + "'>Generate</a><br />" +
                        "<a class='btn btn-success mb-2' style='transform: scaleX(-1);' href='/ExercisePaper/EditOEQuestionsTemplate/" + question.id + "'>&#9998;</a>" +
                        "<a class='btn btn-danger' onclick='return ConfirmDelete()' href='/ExercisePaper/DeleteOEQuestionsTemplate/" + question.id + "'><i class='fa fa-trash'></i></a>" +
                        "</td>" +
                        "</tr>"
                    );
                });
            });
        }
    </script>
}
